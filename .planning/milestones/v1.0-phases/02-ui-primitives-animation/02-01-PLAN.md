---
phase: 02-ui-primitives-animation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - app/globals.css
  - components/ui/AnimatedSection.tsx
  - components/ui/Button.tsx
  - components/ui/index.ts
  - app/page.tsx
autonomous: false
requirements:
  - ANIM-01
  - ANIM-02
  - ANIM-03

must_haves:
  truths:
    - "Sections fade in on first scroll into viewport and stay visible (no replay on scroll-back)"
    - "Staggered elements within a section reveal sequentially with delay offsets"
    - "Primary CTA arrow slides right on hover (~4px)"
    - "Text links show underline sliding in from left on hover"
    - "Keyboard-only focus shows a visible indicator; mouse clicks do not show focus ring"
    - "With prefers-reduced-motion enabled, all content appears instantly with no transition"
    - "Animations perform smoothly at 4x CPU throttling (no jank, no frame drops)"
  artifacts:
    - path: "components/ui/AnimatedSection.tsx"
      provides: "Scroll-triggered fade-in wrapper with optional stagger"
      contains: "useInView"
    - path: "components/ui/Button.tsx"
      provides: "CTA link with arrow hover animation"
      contains: "translate-x"
    - path: "components/ui/index.ts"
      provides: "Barrel export for all UI primitives"
      exports: ["AnimatedSection", "Button"]
    - path: "app/globals.css"
      provides: "Animation tokens, reduced-motion rule, focus-visible, link-underline"
      contains: "prefers-reduced-motion"
  key_links:
    - from: "components/ui/AnimatedSection.tsx"
      to: "react-intersection-observer"
      via: "useInView hook with triggerOnce: true"
      pattern: "useInView.*triggerOnce"
    - from: "components/ui/AnimatedSection.tsx"
      to: "app/globals.css"
      via: "CSS transition on opacity + stagger-child class"
      pattern: "opacity"
    - from: "app/globals.css"
      to: "prefers-reduced-motion"
      via: "@media query disabling all transitions"
      pattern: "prefers-reduced-motion.*reduce"
    - from: "app/page.tsx"
      to: "components/ui/AnimatedSection.tsx"
      via: "import and wrap sections"
      pattern: "AnimatedSection"
---

<objective>
Build the animation system and reusable UI primitives for the Mira Consultancy site. This includes an AnimatedSection wrapper that fades elements in on scroll with optional stagger, a Button component with arrow hover animation, link underline effects, keyboard focus indicators, and full prefers-reduced-motion support.

Purpose: These primitives form the interaction layer that Phase 3 content sections will consume. Every section, CTA, and link on the site depends on these components.
Output: AnimatedSection.tsx, Button.tsx, barrel export, animation CSS tokens, reduced-motion support, wired demo in page.tsx
</objective>

<execution_context>
@/Users/zachsaid/.claude/get-shit-done/workflows/execute-plan.md
@/Users/zachsaid/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-ui-primitives-animation/02-CONTEXT.md
@.planning/phases/02-ui-primitives-animation/02-RESEARCH.md
@.planning/phases/01-foundation-design-system/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Animation infrastructure — install library, add design tokens, base styles</name>
  <files>
    package.json
    app/globals.css
  </files>
  <action>
1. Install react-intersection-observer:
   ```bash
   npm install react-intersection-observer
   ```

2. Add animation design tokens to the existing `@theme` block in `app/globals.css` (append AFTER the existing layout tokens, before the closing `}`):

   ```css
   /* === Animation — timing tokens === */
   --animate-duration-fast: 150ms;
   --animate-duration-base: 200ms;
   --animate-duration-slow: 300ms;
   --animate-duration-fade: 700ms;
   --animate-stagger-delay: 150ms;
   --animate-ease-out: cubic-bezier(0, 0, 0.2, 1);
   ```

3. Add prefers-reduced-motion rule to the `@layer base` block (append inside the existing block):

   ```css
   /* Disable all non-essential animations for users who prefer reduced motion */
   @media (prefers-reduced-motion: reduce) {
     *,
     *::before,
     *::after {
       animation-duration: 0.01ms !important;
       animation-iteration-count: 1 !important;
       transition-duration: 0.01ms !important;
       scroll-behavior: auto !important;
     }
   }
   ```

   Note: Use `0.01ms` not `0ms` — prevents jarring instant snaps while effectively eliminating visible animation.

4. Add focus-visible base styles inside the existing `@layer base` block:

   ```css
   /* Remove default focus outline for mouse users */
   *:focus {
     outline: none;
   }

   /* Keyboard-only focus: visible ring using accent color */
   *:focus-visible {
     outline: 2px solid var(--color-accent);
     outline-offset: 2px;
     border-radius: 2px;
   }
   ```

5. Add link-underline component class and stagger-child animation class. Add a NEW `@layer components` block after the base block:

   ```css
   @layer components {
     /* Underline slides in from left on hover — editorial micro-interaction */
     .link-underline {
       position: relative;
       text-decoration: none;
     }

     .link-underline::after {
       content: '';
       position: absolute;
       bottom: 0;
       left: 0;
       width: 0;
       height: 1px;
       background-color: currentColor;
       transition: width var(--animate-duration-slow) var(--animate-ease-out);
     }

     .link-underline:hover::after,
     .link-underline:focus-visible::after {
       width: 100%;
     }

     /* Stagger children — each child fades in with increasing delay */
     .stagger-child {
       opacity: 0;
       transition: opacity var(--animate-duration-fade) var(--animate-ease-out);
       transition-delay: var(--stagger-delay, 0ms);
     }

     .stagger-child.is-visible {
       opacity: 1;
     }
   }
   ```
  </action>
  <verify>
    - `npm ls react-intersection-observer` shows installed version
    - `app/globals.css` contains `--animate-duration-fade: 700ms`
    - `app/globals.css` contains `prefers-reduced-motion: reduce`
    - `app/globals.css` contains `:focus-visible`
    - `app/globals.css` contains `.link-underline`
    - `app/globals.css` contains `.stagger-child`
    - `npm run build` succeeds (static export still works)
  </verify>
  <done>Animation design tokens, prefers-reduced-motion rule, focus-visible base styles, link-underline component class, and stagger-child animation class all exist in globals.css. react-intersection-observer is installed. Build passes.</done>
</task>

<task type="auto">
  <name>Task 2: Create AnimatedSection, Button components, barrel export, and wire into page</name>
  <files>
    components/ui/AnimatedSection.tsx
    components/ui/Button.tsx
    components/ui/index.ts
    app/page.tsx
  </files>
  <action>
1. **Create `components/ui/AnimatedSection.tsx`** — the scroll-triggered fade-in wrapper:

   ```tsx
   'use client';

   import { useInView } from 'react-intersection-observer';
   import { Children, cloneElement, isValidElement } from 'react';
   import { cn } from '@/lib/utils';

   interface AnimatedSectionProps {
     children: React.ReactNode;
     className?: string;
     /** Intersection Observer threshold (0-1). Default 0.1 = 10% visibility triggers fade. */
     threshold?: number;
     /** When true, children fade in sequentially with stagger delay. */
     stagger?: boolean;
     /** HTML element to render. Default 'section'. */
     as?: 'section' | 'div';
   }

   export function AnimatedSection({
     children,
     className,
     threshold = 0.1,
     stagger = false,
     as: Element = 'section',
   }: AnimatedSectionProps) {
     const { ref, inView } = useInView({
       triggerOnce: true,
       threshold,
     });

     // Simple fade (no stagger) — entire section fades as one unit
     if (!stagger) {
       return (
         <Element
           ref={ref}
           className={cn(
             'transition-opacity ease-out',
             inView ? 'opacity-100' : 'opacity-0',
             className,
           )}
           style={{ transitionDuration: 'var(--animate-duration-fade)' }}
         >
           {children}
         </Element>
       );
     }

     // Staggered fade — each direct child fades in with increasing delay
     const childArray = Children.toArray(children);

     return (
       <Element ref={ref} className={className}>
         {childArray.map((child, index) => {
           if (!isValidElement(child)) return child;

           return cloneElement(child, {
             ...child.props,
             style: {
               ...child.props.style,
               '--stagger-delay': `${index * 150}ms`,
             },
             className: cn(
               child.props.className,
               'stagger-child',
               inView && 'is-visible',
             ),
           });
         })}
       </Element>
     );
   }
   ```

   **Key implementation decisions (Claude's discretion):**
   - `threshold: 0.1` — triggers at 10% visibility, good balance per research
   - `700ms` fade duration via `--animate-duration-fade` CSS token
   - `150ms` stagger delay between children via inline `--stagger-delay` custom property
   - `ease-out` via `--animate-ease-out` (cubic-bezier(0, 0, 0.2, 1)) — natural deceleration
   - `triggerOnce: true` — per user decision (fade in once, stay visible)
   - `as` prop — allows rendering as `<section>` or `<div>` for semantic flexibility
   - `stagger` mode uses `cloneElement` to inject stagger-delay CSS custom properties per child
   - Non-stagger mode uses Tailwind transition utilities with CSS variable duration

2. **Create `components/ui/Button.tsx`** — CTA link with arrow hover animation:

   ```tsx
   import { cn } from '@/lib/utils';

   interface ButtonProps {
     href: string;
     children: React.ReactNode;
     /** 'primary' = accent color with arrow. 'secondary' = muted text, no arrow. */
     variant?: 'primary' | 'secondary';
     className?: string;
     /** Opens link in new tab. Default false. */
     external?: boolean;
   }

   export function Button({
     href,
     children,
     variant = 'primary',
     className,
     external = false,
   }: ButtonProps) {
     return (
       <a
         href={href}
         className={cn(
           'group inline-flex items-center gap-2 font-medium transition-colors',
           variant === 'primary' && 'text-accent hover:text-accent/80',
           variant === 'secondary' &&
             'text-text-secondary hover:text-text-primary link-underline',
           className,
         )}
         style={{ transitionDuration: 'var(--animate-duration-base)' }}
         {...(external && { target: '_blank', rel: 'noopener noreferrer' })}
       >
         <span>{children}</span>
         {variant === 'primary' && (
           <span
             className="inline-block transition-transform ease-out group-hover:translate-x-1"
             style={{ transitionDuration: 'var(--animate-duration-base)' }}
             aria-hidden="true"
           >
             &rarr;
           </span>
         )}
       </a>
     );
   }
   ```

   **Key implementation decisions:**
   - Primary: accent color (#fafaf9) with arrow that slides right 4px (`translate-x-1`) on hover
   - Secondary: muted text-secondary color, no arrow, uses `link-underline` class for underline-on-hover
   - `200ms` transition via `--animate-duration-base` token for snappy hover response
   - `aria-hidden="true"` on arrow — decorative, not semantic
   - `external` prop for Calendly links (opens new tab with security attributes)
   - `group` hover pattern — arrow animates when parent is hovered
   - `ease-out` timing — natural deceleration matching research recommendation

3. **Create `components/ui/index.ts`** — barrel export:

   ```ts
   export { AnimatedSection } from './AnimatedSection';
   export { Button } from './Button';
   ```

4. **Update `app/page.tsx`** — wire components to demonstrate they work:

   Replace the existing page content. Import `AnimatedSection` and `Button` from `@/components/ui`. Wrap each existing section with `<AnimatedSection stagger>` to demonstrate staggered fade-in. Replace the hardcoded CTA link with `<Button href="https://calendly.com/placeholder" external>Book a call</Button>`.

   The page structure should remain the same (Hero, Services, Process, Tech Stack, Contact), but now:
   - Each `<section>` becomes `<AnimatedSection stagger>` with the `section-padding` class
   - The hero section uses `<AnimatedSection stagger>` wrapping a `<div className="prose-width">` containing children
   - The contact CTA uses `<Button href="..." external>Book a call</Button>` (primary variant)
   - Add a secondary button below the primary for email fallback: `<Button href="mailto:hello@mira.co" variant="secondary">hello@mira.co</Button>`

   Important: The `<AnimatedSection>` component is a 'use client' component. In Next.js App Router, client components CAN be imported and used in server components (page.tsx). The page itself stays as a server component — only AnimatedSection hydrates on the client.
  </action>
  <verify>
    - `components/ui/AnimatedSection.tsx` exists and exports `AnimatedSection`
    - `components/ui/Button.tsx` exists and exports `Button`
    - `components/ui/index.ts` exports both components
    - `app/page.tsx` imports from `@/components/ui`
    - `app/page.tsx` wraps sections with `AnimatedSection`
    - `app/page.tsx` uses `Button` component for CTAs
    - `npm run build` succeeds (static export produces `out/` directory)
    - `npm run dev` starts without errors
  </verify>
  <done>AnimatedSection component fades in on scroll with optional stagger. Button component renders CTA with arrow hover animation. Both exported via barrel file. page.tsx demonstrates all components working. Build and dev server both succeed.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Visual verification of animations, hover states, and accessibility</name>
  <files>app/page.tsx</files>
  <action>
    Human verifies all animation and interaction work in browser. No code changes — verification only.

    What was built:
    - AnimatedSection wrapper with staggered fade-in on scroll
    - Button component with arrow slide-right on hover
    - Link underline slide-in on hover
    - Focus-visible keyboard indicators
    - prefers-reduced-motion support
  </action>
  <verify>
    1. **Start dev server:** `npm run dev` and visit `http://localhost:3000`

    2. **Scroll animations (ANIM-01):**
       - Refresh the page — hero section should fade in with stagger (heading first, then text)
       - Scroll down slowly — each section should fade in as it enters the viewport
       - Elements within each section should stagger (label, heading, content appear sequentially)
       - Scroll back up — sections should STAY visible (no re-animation)

    3. **Hover states (ANIM-02):**
       - Hover over "Book a call" CTA — arrow should slide right smoothly (~4px)
       - Hover over the email link — underline should slide in from left
       - Both transitions should feel smooth and snappy (~200ms)

    4. **Focus states (ANIM-02):**
       - Press Tab to navigate through interactive elements
       - CTA and links should show a visible focus indicator (accent-colored outline)
       - Click with mouse — focus ring should NOT appear

    5. **Reduced motion (ANIM-03):**
       - Open Chrome DevTools > Rendering panel > check "Emulate CSS media feature prefers-reduced-motion"
       - Refresh the page — all content should appear instantly, no fade, no stagger
       - Hover states should still change color but without visible transition

    6. **Performance check:**
       - Open Chrome DevTools > Performance tab > set CPU throttling to 4x slowdown
       - Scroll through the page — animations should still feel smooth, no jank or frame drops

    **Expected feel:** Editorial, restrained. Pure fades, no sliding or bouncing. The arrow on CTA hover is the most kinetic element. Everything else is measured.
  </verify>
  <done>User confirms: scroll fade-in works, stagger reveals sequentially, CTA arrow animates on hover, link underline slides in, focus-visible shows for keyboard only, reduced-motion disables all animation, performance is smooth at 4x CPU throttling.</done>
</task>

</tasks>

<verification>
After all tasks complete and checkpoint passes:

1. **Build verification:** `npm run build` produces `out/` directory without errors
2. **Component exports:** `components/ui/index.ts` exports AnimatedSection and Button
3. **ANIM-01 verified:** Sections fade in on scroll using Intersection Observer + CSS transitions
4. **ANIM-02 verified:** Button hover state (arrow slide), link hover state (underline slide), focus-visible indicator all functional
5. **ANIM-03 verified:** prefers-reduced-motion media query disables all transitions globally
6. **No Card component:** Per user decision, no Card component exists (skip entirely)
7. **No Typography component:** Per Claude's discretion, semantic HTML + CSS defaults are sufficient
</verification>

<success_criteria>
- AnimatedSection wraps sections and fades them in on scroll (trigger once, 10% threshold)
- Staggered mode reveals children sequentially with 150ms delay offsets
- Button renders as text link with arrow that slides right on hover
- Secondary button variant exists for email fallback (muted color, no arrow, underline on hover)
- Link underline animates width 0 -> 100% from left on hover
- Focus-visible shows accent-colored outline for keyboard navigation only
- prefers-reduced-motion: reduce disables all transitions via 0.01ms duration override
- All animations use CSS tokens from @theme (--animate-duration-fade, --animate-stagger-delay, etc.)
- Static build succeeds
- Human verification confirms animations feel editorial and restrained
</success_criteria>

<output>
After completion, create `.planning/phases/02-ui-primitives-animation/02-01-SUMMARY.md`
</output>
