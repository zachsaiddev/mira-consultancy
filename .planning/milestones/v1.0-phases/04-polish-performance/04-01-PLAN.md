---
phase: 04-polish-performance
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/optimize-images.mjs
  - scripts/generate-og-image.mjs
  - public/images/zach.webp
  - public/images/logo.webp
  - app/opengraph-image.png
  - app/layout.tsx
  - components/sections/About.tsx
  - components/sections/Hero.tsx
  - components/sections/Intro.tsx
autonomous: true

must_haves:
  truths:
    - "Profile photo loads correctly on deployed site (no 404)"
    - "Images are served as WebP at appropriate display sizes"
    - "OpenGraph meta tags produce correct social media previews with branded image"
    - "OG image URL includes basePath for GitHub Pages"
  artifacts:
    - path: "public/images/zach.webp"
      provides: "Optimized profile photo at 400px width"
    - path: "public/images/logo.webp"
      provides: "Optimized logo in WebP format"
    - path: "app/opengraph-image.png"
      provides: "Static 1200x630 OG image for social previews"
    - path: "app/layout.tsx"
      provides: "Full metadata export with OG, Twitter Card, and metadataBase"
    - path: "scripts/optimize-images.mjs"
      provides: "Repeatable image conversion script"
  key_links:
    - from: "app/layout.tsx"
      to: "app/opengraph-image.png"
      via: "metadataBase resolves relative OG image path"
      pattern: "metadataBase.*github\\.io/mira-consultancy"
    - from: "components/sections/About.tsx"
      to: "public/images/zach.webp"
      via: "Image src attribute"
      pattern: "src.*zach\\.webp"
    - from: "components/sections/Hero.tsx"
      to: "public/images/logo.webp"
      via: "Image src with NEXT_PUBLIC_BASE_PATH"
      pattern: "logo\\.webp"
---

<objective>
Optimize all images to WebP, fix the profile.jpg 404 bug, create a branded OG image, and add full OpenGraph/Twitter Card metadata to layout.tsx.

Purpose: The profile photo 404 is a live production bug. The 2.3MB zach.png is the biggest single drag on LCP and Lighthouse score. OG tags are required for correct social media previews on LinkedIn, Twitter, iMessage, and Slack.

Output: WebP images in public/images/, static OG image in app/, updated metadata in layout.tsx, image conversion script in scripts/.
</objective>

<execution_context>
@/Users/zach.said/.claude/get-shit-done/workflows/execute-plan.md
@/Users/zach.said/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-polish-performance/04-RESEARCH.md

@app/layout.tsx
@components/sections/About.tsx
@components/sections/Hero.tsx
@components/sections/Intro.tsx
@next.config.ts
@public/images/
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert images to WebP and fix profile.jpg 404 bug</name>
  <files>
    scripts/optimize-images.mjs
    public/images/zach.webp
    public/images/logo.webp
    components/sections/About.tsx
    components/sections/Hero.tsx
    components/sections/Intro.tsx
  </files>
  <action>
1. Create `scripts/optimize-images.mjs` using sharp (available as transitive dep via next@16.1.6 — do NOT install separately):

```javascript
import sharp from 'sharp'
import { join, dirname } from 'node:path'
import { fileURLToPath } from 'node:url'

const __dirname = dirname(fileURLToPath(import.meta.url))
const PUBLIC = join(__dirname, '..', 'public', 'images')

// Profile photo: 400x400 for 2x retina at max 200px display
await sharp(join(PUBLIC, 'zach.png'))
  .resize(400, 400, { fit: 'cover', position: 'top' })
  .webp({ quality: 82 })
  .toFile(join(PUBLIC, 'zach.webp'))

// Logo: keep original dimensions, convert format only
await sharp(join(PUBLIC, 'logo.png'))
  .webp({ quality: 90 })
  .toFile(join(PUBLIC, 'logo.webp'))

console.log('Images optimized.')
```

2. Run the script: `node scripts/optimize-images.mjs`

3. Fix `About.tsx` — change `src="/images/profile.jpg"` to use the WebP image with NEXT_PUBLIC_BASE_PATH:
   - Change to: `src={`${process.env.NEXT_PUBLIC_BASE_PATH ?? ''}/images/zach.webp`}`
   - Add `'use client'` directive if not already present (needed for process.env.NEXT_PUBLIC_BASE_PATH)
   - Note: About.tsx currently does NOT use NEXT_PUBLIC_BASE_PATH — it must be added

4. Update `Hero.tsx` — change logo src from `logo.png` to `logo.webp`:
   - Change: `src={`${process.env.NEXT_PUBLIC_BASE_PATH ?? ''}/images/logo.webp`}`

5. Update `Intro.tsx` — change profile photo from `zach.png` to `zach.webp`:
   - Change: `src={`${process.env.NEXT_PUBLIC_BASE_PATH ?? ''}/images/zach.webp`}`

Keep original .png files in public/images/ as source files. Keep `unoptimized` prop on all `<Image>` components — required for `output: 'export'`.
  </action>
  <verify>
    - `ls -la public/images/zach.webp` — file exists and is under 50KB (was 2.3MB PNG)
    - `ls -la public/images/logo.webp` — file exists
    - `grep -r "profile.jpg" components/` returns no matches (404 bug fixed)
    - `grep "zach.webp" components/sections/About.tsx` returns a match
    - `grep "logo.webp" components/sections/Hero.tsx` returns a match
    - `grep "zach.webp" components/sections/Intro.tsx` returns a match
    - `npm run build` completes without errors
  </verify>
  <done>All images converted to WebP. profile.jpg 404 is fixed. All three components (About, Hero, Intro) reference .webp files with NEXT_PUBLIC_BASE_PATH. Build passes.</done>
</task>

<task type="auto">
  <name>Task 2: Create OG image and add full metadata to layout.tsx</name>
  <files>
    scripts/generate-og-image.mjs
    app/opengraph-image.png
    app/layout.tsx
  </files>
  <action>
1. Create `scripts/generate-og-image.mjs` — a Node script using sharp to generate a 1200x630 branded OG image:
   - Dark background matching site background (#0a0c14)
   - Composite the logo (public/images/logo.png — use original PNG for source quality) centered horizontally, positioned in the upper-third
   - Add the tagline below the logo: "Custom applications, AI agents, and workflow automation — built with precision for businesses that need to move fast."
   - Use sharp's text overlay via SVG embedding (sharp can composite SVG text onto the base):
     ```javascript
     const textSvg = `<svg width="1200" height="630">
       <text x="600" y="380" text-anchor="middle" font-family="sans-serif" font-size="28" fill="#a3a3a3">
         Custom applications, AI agents, and workflow automation
       </text>
       <text x="600" y="420" text-anchor="middle" font-family="sans-serif" font-size="28" fill="#a3a3a3">
         built with precision for businesses that need to move fast.
       </text>
     </svg>`
     ```
   - Output to `app/opengraph-image.png` (must be PNG — OG images don't support WebP)
   - Final file must be 1200x630 pixels

2. Run the script: `node scripts/generate-og-image.mjs`

3. Update `app/layout.tsx` metadata export to include full OG and Twitter Card fields:

```typescript
import type { Metadata } from 'next'

export const metadata: Metadata = {
  metadataBase: new URL('https://zachsaiddev.github.io/mira-consultancy'),
  title: 'Mira Consultancy — Custom Software for Growing Businesses',
  description:
    'Custom applications, AI agents, and workflow automation — built with precision for businesses that need to move fast.',
  openGraph: {
    title: 'Mira Consultancy — Custom Software for Growing Businesses',
    description:
      'Custom applications, AI agents, and workflow automation — built with precision for businesses that need to move fast.',
    url: 'https://zachsaiddev.github.io/mira-consultancy',
    siteName: 'Mira Consultancy',
    locale: 'en_US',
    type: 'website',
  },
  twitter: {
    card: 'summary_large_image',
    title: 'Mira Consultancy — Custom Software for Growing Businesses',
    description:
      'Custom applications, AI agents, and workflow automation — built with precision for businesses that need to move fast.',
  },
}
```

CRITICAL: `metadataBase` must be `new URL('https://zachsaiddev.github.io/mira-consultancy')` — include the basePath. The GitHub username is `zachsaiddev`, not `zach.said`.

The file-based `app/opengraph-image.png` takes precedence for the image URL via Next.js file convention — do NOT add images array to the metadata object.

Keep the existing font imports, BackgroundGradient import, and RootLayout function unchanged — only update the metadata export and add metadataBase.
  </action>
  <verify>
    - `ls -la app/opengraph-image.png` — file exists, 1200x630
    - `node -e "const sharp = require('sharp'); sharp('app/opengraph-image.png').metadata().then(m => console.log(m.width, m.height))"` — outputs "1200 630"
    - `grep "metadataBase" app/layout.tsx` returns a match
    - `grep "zachsaiddev.github.io/mira-consultancy" app/layout.tsx` returns a match
    - `grep "openGraph" app/layout.tsx` returns a match
    - `grep "twitter" app/layout.tsx` returns a match
    - `npm run build` completes without errors
  </verify>
  <done>Static OG image at app/opengraph-image.png (1200x630, dark branded). layout.tsx has full metadata with metadataBase, openGraph, and twitter card fields. Build passes.</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds with no errors
2. All image references in components point to .webp files
3. No reference to `profile.jpg` exists anywhere in the codebase
4. `app/opengraph-image.png` exists at 1200x630
5. `metadataBase` in layout.tsx includes full basePath URL
6. WebP files are significantly smaller than their PNG originals
</verification>

<success_criteria>
- zach.webp exists at < 50KB (down from 2.3MB PNG)
- logo.webp exists
- opengraph-image.png exists at 1200x630
- layout.tsx has metadataBase, openGraph, and twitter metadata
- All three components (About, Hero, Intro) use .webp image paths
- profile.jpg 404 bug is fixed
- Build passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/04-polish-performance/04-01-SUMMARY.md`
</output>
