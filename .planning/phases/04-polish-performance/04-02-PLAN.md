---
phase: 04-polish-performance
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/globals.css
  - components/ui/AnimatedSection.tsx
  - lib/hooks/usePrefersReducedMotion.ts
autonomous: true

must_haves:
  truths:
    - "AnimatedSection respects prefers-reduced-motion — content visible immediately without flash"
    - "Gradient orb blur is optimized for mobile GPU without visible quality loss"
    - "All interactive elements are keyboard-navigable with visible focus indicators"
    - "prefers-reduced-motion disables all non-essential motion site-wide"
  artifacts:
    - path: "lib/hooks/usePrefersReducedMotion.ts"
      provides: "Reusable reduced-motion detection hook"
    - path: "components/ui/AnimatedSection.tsx"
      provides: "AnimatedSection with reduced-motion guard"
      contains: "usePrefersReducedMotion"
    - path: "app/globals.css"
      provides: "Optimized blur radius on gradient orbs"
      contains: "blur(70px)"
  key_links:
    - from: "components/ui/AnimatedSection.tsx"
      to: "lib/hooks/usePrefersReducedMotion.ts"
      via: "import and conditional render"
      pattern: "usePrefersReducedMotion"
    - from: "app/globals.css"
      to: "components/ui/BackgroundGradient.tsx"
      via: "CSS class .gradient-orb filter property"
      pattern: "filter.*blur"
---

<objective>
Optimize mobile GPU performance by reducing orb blur radius, add prefers-reduced-motion guard to AnimatedSection, and verify accessibility fundamentals (keyboard nav, focus indicators, touch targets).

Purpose: The 6 gradient orbs with filter: blur(100px) on 50-60vw elements are the biggest GPU cost on mobile. AnimatedSection is the only animation component missing a prefers-reduced-motion check, causing content to flash from opacity-0 for reduced-motion users. These fixes directly impact Lighthouse Performance and Accessibility scores.

Output: Reduced blur in globals.css, usePrefersReducedMotion hook, updated AnimatedSection, accessibility fixes.
</objective>

<execution_context>
@/Users/zach.said/.claude/get-shit-done/workflows/execute-plan.md
@/Users/zach.said/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-polish-performance/04-RESEARCH.md

@app/globals.css
@components/ui/AnimatedSection.tsx
@components/ui/BackgroundGradient.tsx
@lib/hooks/useParallax.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create usePrefersReducedMotion hook and fix AnimatedSection</name>
  <files>
    lib/hooks/usePrefersReducedMotion.ts
    components/ui/AnimatedSection.tsx
  </files>
  <action>
1. Create `lib/hooks/usePrefersReducedMotion.ts` — a reusable hook consistent with the patterns in BackgroundGradient.tsx and useParallax.ts:

```typescript
'use client'

import { useEffect, useState } from 'react'

/**
 * Returns true if the user prefers reduced motion.
 * SSR-safe: defaults to false (animations enabled), then checks on mount.
 */
export function usePrefersReducedMotion(): boolean {
  const [prefersReduced, setPrefersReduced] = useState(false)

  useEffect(() => {
    const mql = window.matchMedia('(prefers-reduced-motion: reduce)')
    setPrefersReduced(mql.matches)

    const handler = (e: MediaQueryListEvent) => setPrefersReduced(e.matches)
    mql.addEventListener('change', handler)
    return () => mql.removeEventListener('change', handler)
  }, [])

  return prefersReduced
}
```

Note: This hook also listens for runtime changes (e.g., user toggles setting while page is open), which neither BackgroundGradient nor useParallax currently do. This is a small improvement.

2. Update `components/ui/AnimatedSection.tsx` to use the hook:

Import the hook:
```typescript
import { usePrefersReducedMotion } from '@/lib/hooks/usePrefersReducedMotion'
```

At the top of the AnimatedSection function body, call the hook:
```typescript
const prefersReduced = usePrefersReducedMotion()
```

**For the non-stagger path:** If `prefersReduced` is true, render children immediately as fully visible — no opacity-0, no translate-y-5, no transition:
```typescript
if (!stagger) {
  if (prefersReduced) {
    return (
      <Element className={className}>
        {children}
      </Element>
    )
  }
  // ... existing animation code with ref, inView, etc.
}
```

**For the stagger path:** If `prefersReduced` is true, render children without animation styles:
```typescript
if (prefersReduced) {
  return (
    <Element className={className}>
      {children}
    </Element>
  )
}
```

Place the reduced-motion early return BEFORE the `useInView` hook call? NO — hooks must be called unconditionally. Call `useInView` first, then conditionally render. The `useInView` call is lightweight when its ref isn't observed, so this is fine.

Actually, `useInView` is already called at the top of the component. Keep it there. Add the `prefersReduced` check after both hooks, before the rendering logic:

```typescript
const { ref, inView } = useInView({ triggerOnce: true, threshold })
const prefersReduced = usePrefersReducedMotion()

// Skip all animation for reduced-motion users
if (prefersReduced) {
  return (
    <Element className={className}>
      {children}
    </Element>
  )
}

// ... rest of existing code unchanged
```

This avoids the flash where content starts at opacity-0 then transitions — reduced-motion users see content immediately.
  </action>
  <verify>
    - `cat lib/hooks/usePrefersReducedMotion.ts` exists with hook implementation
    - `grep "usePrefersReducedMotion" components/ui/AnimatedSection.tsx` returns a match
    - `grep "prefersReduced" components/ui/AnimatedSection.tsx` returns a match
    - `npm run build` completes without errors
  </verify>
  <done>usePrefersReducedMotion hook created. AnimatedSection skips all animation for reduced-motion users — content renders immediately visible. No opacity flash.</done>
</task>

<task type="auto">
  <name>Task 2: Optimize gradient orb blur and verify accessibility fundamentals</name>
  <files>
    app/globals.css
  </files>
  <action>
1. In `app/globals.css`, reduce the gradient orb blur from 100px to 70px:
   - Find: `filter: blur(100px);` (line 108 in .gradient-orb rule)
   - Replace with: `filter: blur(70px);`
   - Rationale: blur cost scales quadratically with radius. 70px on 50-60vw elements is visually indistinguishable from 100px at this scale but reduces GPU texture processing significantly. Per research: "Reduces GPU texture processing area" and is "Visually equivalent at large scale."
   - This is within Claude's discretion per CONTEXT.md: "Any performance optimizations that don't remove visual effects"

2. Verify existing accessibility features are correct (read-only checks, fix if issues found):

   a. **focus-visible** — Already implemented in globals.css:
      ```css
      *:focus { outline: none; }
      *:focus-visible { outline: 2px solid var(--color-accent); outline-offset: 2px; border-radius: 2px; }
      ```
      This is correct. No changes needed.

   b. **prefers-reduced-motion** — Already implemented in globals.css:
      ```css
      @media (prefers-reduced-motion: reduce) {
        *, *::before, *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
          scroll-behavior: auto !important;
        }
      }
      ```
      This is correct. No changes needed.

   c. **BackgroundGradient aria-hidden** — Already set: `aria-hidden="true"`. Correct.

   d. **Check touch target sizes** — The Button component renders as `<a>` tags. Verify that CTA buttons have sufficient padding for 44x44px minimum touch targets. If the Button component's padding is less than py-3 (12px) on mobile, increase it. (Check the actual Button.tsx during execution.)

   e. **Check tech stack icon accessibility** — TechStack.tsx renders icon divs with `title` attributes. If they lack proper accessible names (aria-label or sr-only text), add `role="img"` and `aria-label` matching the `title` text.

3. Verify the `<html lang="en">` attribute exists (it does — in layout.tsx). No change needed.

NOTE: Do NOT remove any visual effects. The user locked "keep all visual effects." The blur reduction is an optimization, not a removal — the effect is visually identical.
  </action>
  <verify>
    - `grep "blur(70px)" app/globals.css` returns a match
    - `grep -c "blur(100px)" app/globals.css` returns 0 (old value removed)
    - `grep "focus-visible" app/globals.css` confirms focus indicators exist
    - `grep "prefers-reduced-motion" app/globals.css` confirms reduced-motion support exists
    - `npm run build` completes without errors
  </verify>
  <done>Orb blur reduced from 100px to 70px for mobile GPU performance. Accessibility fundamentals verified: focus-visible indicators, prefers-reduced-motion, aria-hidden on decorative elements, touch targets, lang attribute. Build passes.</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. AnimatedSection imports and uses usePrefersReducedMotion
3. Gradient orb blur is 70px (not 100px)
4. Existing accessibility features (focus-visible, reduced-motion, aria-hidden) still work
5. No visual effects removed — only blur radius optimized
</verification>

<success_criteria>
- usePrefersReducedMotion hook exists and is used by AnimatedSection
- AnimatedSection renders content immediately for reduced-motion users (no opacity-0 flash)
- Gradient orb blur is 70px
- All accessibility fundamentals verified (focus-visible, reduced-motion, aria-hidden, lang)
- Build passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/04-polish-performance/04-02-SUMMARY.md`
</output>
